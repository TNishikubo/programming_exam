# programming_exam

#共通
以下の形式のcsvファイルを同じフォルダに置き実行する。
-------------------------------------------------
datetime,server_address,ping
20201019133124,10.20.30.1/16,2
20201019133125,10.20.30.2/16,1
20201019133134,192.168.1.1/24,10
20201019133135,192.168.1.2/24,5
-------------------------------------------------

#設問1
"server_log.csv" を読み込み実行する。

pingがタイムアウトした時
"(タイムアウト時刻)_ (タイムアウトしたサーバーのIPアドレス) Crash"
という形式で表示され、故障と判定される。

タイムアウト発生後に初めて応答した時
(タイムアウトしたサーバーのIPアドレス) Crash_length: (タイムアウトが続いた時間)
という形式で表示され、故障が継続した時間が出力される。

そのサーバーが故障から復帰しない場合(そのサーバーにおけるpingの最後の行が"-"の場合)
故障が継続中であるとみなし、故障が継続した時間は出力されない。

実行結果
2020-10-19 13:33:24_ Server10.20.30.1/16 Crash
Server10.20.30.1/16 Crash_length: 0:03:00
2020-10-19 13:41:24_ Server10.20.30.1/16 Crash
Server10.20.30.1/16 Crash_length: 0:01:00
2020-10-19 13:42:25_ Server10.20.30.2/16 Crash
2020-10-19 13:38:34_ Server192.168.1.1/24 Crash
Server192.168.1.1/24 Crash_length: 0:02:00
2020-10-19 13:33:35_ Server192.168.1.2/24 Crash
Server192.168.1.2/24 Crash_length: 0:01:00

--------------------------------------------------------------------------------------------------


#設問2
"server_log.csv" を読み込み実行する。
設問1のプログラムを、N回以上連続したタイムアウトが発生した場合のみ故障とみなすように変更した。

Nの値を変えるには"WAIT"の値を変更する。
WAIT=2の場合、2回までのタイムアウトは故障とみなさない。
3回以上連続した場合 
"(タイムアウト時刻)_ (タイムアウトしたサーバーのIPアドレス) Crash" 
という形式で表示され、故障と判定される。

故障継続時間は初めにタイムアウトが発生した時刻からカウントする。

実行結果
2020-10-19 13:35:24_ Server10.20.30.1/16 Crash
Server10.20.30.1/16 Crash_length: 0:03:00

--------------------------------------------------------------------------------------------------

#設問3
設問2のプログラムに過負荷状態となった期間を出力する機能を追加した。
"server_log.csv" を読み込み実行する。
直近m回の平均応答時間がtミリ秒を超えた場合は、サーバが過負荷状態になっているとみなす。
mの値を変えるには "AVE_RANGE", tの値を変えるには"PING_OVER"の値を変更する。
pingが"-"の場合はpingが PING_OVER*AVE_RANGE であるとみなす。("-"を含む範囲では必ず過負荷状態であると判定される)

初めて過負荷状態と判定された時
"(過負荷状態と判定された時刻)_ (過負荷状態になったサーバーのIPアドレス) Overload"
という形式で表示される。

過負荷状態でなくなった時
(過負荷状態が解除された時刻)_ (過負荷状態になったサーバーのIPアドレス) Overload_length: (過負荷状態が続いた時間)
という形式で表示される。

故障が発生して再び応答した場合
(故障したサーバーのIPアドレス) Crash_length: (故障が続いた時間)
のみが表示され、過負荷状態が継続した時間は出力されない。

過負荷状態が継続中である場合(そのサーバーにおける最後のm回の平均がtミリ秒を超えたとき)
過負荷状態が継続した時間は出力されない。



実行結果
2020-10-19 13:32:24_ Server10.20.30.1/16 Overload
2020-10-19 13:35:24_ Server10.20.30.1/16 Crash
2020-10-19 13:36:24_ Server10.20.30.1/16 Crash_length: 0:03:00
2020-10-19 13:41:24_ Server10.20.30.1/16 Overload
2020-10-19 13:42:25_ Server10.20.30.2/16 Overload
2020-10-19 13:38:34_ Server192.168.1.1/24 Overload
2020-10-19 13:42:34_ Server192.168.1.1/24 Overload_length: 0:04:00
2020-10-19 13:33:35_ Server192.168.1.2/24 Overload
2020-10-19 13:36:35_ Server192.168.1.2/24 Overload_length: 0:03:00
--------------------------------------------------------------------------------------------------

#設問4
設問3のプログラムにサブネット内のサーバが全て故障している場合はサブネットスイッチの故障であるとみなす機能を追加した。

"server_log_subnet.csv" を読み込み実行する。

スイッチの配下にある全てのサーバーの集合と故障が発生中のサーバーの集合を比較することで、
サブネット内の全てのサーバーの故障を判定する。



サブネット内全てのサーバーがN回タイムアウトした時
"(判定時刻)_ (故障したサブネット) Crash"
という形式で表示され、サブネットスイッチの故障と判定される。

サブネット故障後、サブネット内のいずれかのサーバーが初めて応答した時
(判定解除された時刻)_(故障したサブネット) Crash_length: (サブネットの故障が続いた時間)
という形式で表示され、故障が継続した時間が出力される。

サブネットスイッチの故障継続時間は初めに配下のサーバーが全てタイムアウトした時刻からカウントする。

サブネットの故障が継続中である場合(そのサブネットに所属するサーバー全てのpingの最後の行が"-"の場合)、
故障が継続した時間は出力されない。


実行結果
2020-10-19 13:32:24_ Server10.20.30.1/16 Overload
2020-10-19 13:35:24_ Server10.20.30.1/16 Crash
2020-10-19 13:36:24_ Server10.20.30.1/16 Crash_length: 0:03:00
2020-10-19 13:41:24_ Server10.20.30.1/16 Overload
2020-10-19 13:44:24_ Server10.20.30.1/16 Overload_length: 0:03:00
2020-10-19 13:42:25_ Server10.20.30.2/16 Overload
2020-10-19 13:44:25_ Server10.20.30.2/16 Crash
2020-10-19 13:46:25_ Server10.20.30.2/16 Crash_length: 0:04:00
2020-10-19 13:38:34_ Server192.168.1.1/24 Overload
2020-10-19 13:44:34_ Server192.168.1.1/24 Crash
2020-10-19 13:53:34_ Server192.168.1.1/24 Crash_length: 0:11:00 
2020-10-19 13:33:35_ Server192.168.1.2/24 Overload
2020-10-19 13:36:35_ Server192.168.1.2/24 Overload_length: 0:03:00
2020-10-19 13:45:35_ Server192.168.1.2/24 Overload
2020-10-19 13:47:35_ Server192.168.1.2/24 Crash
2020-10-19 13:47:35_ Subnet switch192.168.1.0/24 Crash
2020-10-19 13:53:35_ Subnet switch192.168.1.0/24 Crash_length: 0:08:00
2020-10-19 13:53:35_ Server192.168.1.2/24 Crash_length: 0:08:00


上記実行結果中では、

2020-10-19 13:44:34_ Server192.168.1.1/24 Crash
020-10-19 13:53:34_ Server192.168.1.1/24 Crash_length: 0:11:00
と
2020-10-19 13:47:35_ Server192.168.1.2/24 Crash
2020-10-19 13:53:35_ Server192.168.1.2/24 Crash_length: 0:08:00
の
故障が同一サブネット内で発生しているため、同時に2つのサーバーが故障したと判定されたときに
2020-10-19 13:47:35_ Subnet switch192.168.1.0/24 Crash
が出力され、応答が戻った時に
2020-10-19 13:53:35_ Subnet switch192.168.1.0/24 Crash_length: 0:08:00
が出力される。

--------------------------------------------------------------------------------------------------
